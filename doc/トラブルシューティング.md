# 🆘 Nemotron JP Persona Chat - トラブルシューティング

よくある問題とその解決方法をまとめました。問題が解決しない場合は、各項目を順番に試してください。

## ⚡ 緊急時の基本対応

### 🔄 まず試すこと（5分で解決することが多い）

1. **全てのサーバーを停止**
```bash
# ターミナルで Ctrl+C を押してサーバーを停止
# または新しいターミナルで：
pkill -f "python server.py"
pkill -f "streamlit run"
```

2. **サーバーを再起動**
```bash
# ターミナル1でAIサーバー
cd /home/ichimaru/git/nemo_chat_app
source .venv/bin/activate
python server.py

# ターミナル2でStreamlit
cd /home/ichimaru/git/nemo_chat_app
source .venv/bin/activate
streamlit run app.py
```

3. **ブラウザをリフレッシュ** (F5 または Cmd+R)

## 🚫 エラーメッセージ別の対処法

### 「リクエストタイムアウト（120秒）」

**原因:** AIモデルの処理が120秒を超えた
**解決方法:**
1. メッセージを短くして再試行
2. 詳細設定で「最大トークン数」を1000以下に設定
3. サーバーの負荷を確認

### 「🔌 接続エラー」

**原因:** FastAPIサーバーが起動していない
**解決方法:**
1. サーバーが起動しているか確認
```bash
curl http://localhost:8080
```
2. 起動していない場合は起動
```bash
cd /home/ichimaru/git/nemo_chat_app
source .venv/bin/activate
python server.py
```

### 「🚫 サーバーエラー: 500」

**原因:** サーバー内部エラー
**解決方法:**
1. サーバーのログを確認
2. サーバーを再起動
3. メモリ不足の可能性 → 他のアプリを終了

### 「ModuleNotFoundError: No module named 'xxx'」

**原因:** 必要なライブラリが不足
**解決方法:**
```bash
cd /home/ichimaru/git/nemo_chat_app
source .venv/bin/activate
pip install -r requirements.txt
```

## 💻 起動時の問題

### Python が見つからない

**エラー例:**
```
python: command not found
```

**解決方法:**
1. **Windows:**
   - [python.org](https://python.org/downloads/)からPythonをインストール
   - インストール時に「Add to PATH」をチェック

2. **Mac:**
   ```bash
   brew install python3
   ```

3. **Linux:**
   ```bash
   sudo apt update
   sudo apt install python3 python3-pip
   ```

### 仮想環境が作成できない

**エラー例:**
```
The virtual environment was not created successfully
```

**解決方法:**
```bash
# 古い仮想環境を削除
rm -rf .venv

# 再作成
python -m venv .venv

# または python3 を使用
python3 -m venv .venv
```

### 仮想環境の有効化に失敗

**Windows での問題:**
```
execution of scripts is disabled on this system
```

**解決方法:**
管理者権限でPowerShellを開き：
```powershell
Set-ExecutionPolicy RemoteSigned
```

## 🐌 パフォーマンス問題

### AIの応答が遅い

**30秒以上かかる場合:**

1. **詳細設定を調整**
   - 最大トークン数: 1000以下
   - 創造性: 0.5以下

2. **メッセージを短く**
   - 長文ではなく簡潔に

3. **PCのスペック確認**
   - メモリ使用量をタスクマネージャーで確認
   - 他のアプリを終了

### メモリ不足エラー

**エラー例:**
```
RuntimeError: CUDA out of memory
OutOfMemoryError
```

**解決方法:**

1. **他のアプリケーションを終了**

2. **スワップファイルを増やす (Linux)**
```bash
sudo fallocate -l 4G /swapfile
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile
```

3. **CPUモードで実行**
環境変数を設定：
```bash
export CUDA_VISIBLE_DEVICES=""
```

## 🌐 ブラウザの問題

### ブラウザでページが開かない

**確認事項:**
1. 正しいURL: `http://localhost:8501`
2. Streamlitサーバーが起動中
3. ポート8501が使用可能

**解決方法:**
```bash
# ポート使用状況確認
netstat -tulpn | grep :8501

# 別のポートで起動
streamlit run app.py --server.port 8502
```

### ページが古い

**症状:**
- 変更が反映されない
- 古いエラーメッセージが表示

**解決方法:**
1. **ハードリフレッシュ**
   - Windows: Ctrl + Shift + R
   - Mac: Cmd + Shift + R

2. **キャッシュクリア**
   - ブラウザの設定からキャッシュを削除

## 📦 インストール問題

### pip install でエラー

**一般的なエラー:**
```
ERROR: Could not install packages due to an environment error
```

**解決方法:**

1. **pipをアップデート**
```bash
pip install --upgrade pip
```

2. **権限エラーの場合**
```bash
pip install --user -r requirements.txt
```

3. **特定パッケージのエラー**
```bash
# 個別にインストール
pip install torch --index-url https://download.pytorch.org/whl/cpu
pip install transformers
pip install streamlit
pip install fastapi
```

### 依存関係の衝突

**エラー例:**
```
ERROR: pip's dependency resolver does not currently take into account all the packages that are installed
```

**解決方法:**
```bash
# 仮想環境を作り直し
rm -rf .venv
python -m venv .venv
source .venv/bin/activate  # Linux/Mac
# .venv\Scripts\activate  # Windows
pip install --upgrade pip
pip install -r requirements.txt
```

## 🔍 詳細診断

### システム情報の確認

**Python環境:**
```bash
python --version
pip --version
pip list
```

**メモリ・CPU:**
```bash
# Linux/Mac
free -h
top

# Windows
wmic OS get TotalVisibleMemorySize,FreePhysicalMemory
```

**ディスク容量:**
```bash
# Linux/Mac
df -h

# Windows
dir
```

## 📞 サポート情報収集

問題が解決しない場合、以下の情報を集めて相談してください：

### 🔍 診断用コマンド

```bash
# 環境情報
echo "=== Python Version ==="
python --version

echo "=== Installed Packages ==="
pip list

echo "=== System Info ==="
uname -a  # Linux/Mac
# systeminfo  # Windows

echo "=== Port Usage ==="
netstat -tulpn | grep :8080
netstat -tulpn | grep :8501

echo "=== Process Info ==="
ps aux | grep python
```

### 📝 報告テンプレート

```
**問題の概要:**
[どんな問題が発生したか]

**エラーメッセージ:**
[エラーメッセージをコピペ]

**実行環境:**
- OS: [Windows/Mac/Linux]
- Python: [バージョン]
- メモリ: [GB]

**試した解決方法:**
1. [試したこと1]
2. [試したこと2]

**期待する動作:**
[こうなってほしい]
```

## 💡 予防策

### 定期メンテナンス

**週1回:**
```bash
# 仮想環境でパッケージ更新
source .venv/bin/activate
pip install --upgrade pip
```

**月1回:**
```bash
# 仮想環境の再作成
rm -rf .venv
python -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
```

### バックアップ

**重要ファイル:**
- `app.py`
- `server.py`
- `requirements.txt`
- `doc/` フォルダ

定期的にコピーを作成しておきましょう。

---

🎯 **ほとんどの問題は再起動で解決します！困った時はまず再起動を試してください。**